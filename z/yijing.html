<!doctype html>
<html>
<head>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=0">
<title>
易经
</title>
</head>
<body>
<!--
三个变量 
值为：   0 1 
对应为： 2 3
即：
111 9 阳  ——————
110 8 阴  ——  ——
100 7 阳  —————— 
000 6 阴  ——  ——


按6次，由下网上对应卦

-->


<div style="height:500px;">
    <div style="margin: 0 auto;margin-top:50px;height:50px;width:80%">
    <ul id="gua"> </ul>
    </div>
</div>

<div style="position:fiexd;margin: 0 auto;width:50px;margin-top:50px">
<button onclick="operation()" style="margin-top:10px;height:50px;width:50px;">X</button>
</div>
<script>
function getYaoRaw() {
    // 爻 3变量
    var yaoRaw = [];
    for (var i=0;i<3;i++) {
        var subYao = Math.round(Math.random()*10000) % 2;
        yaoRaw.push(subYao)
    }
    // console.log("yaoRaw: "+yaoRaw)
    return yaoRaw
}

function _getYao(yaoRaw){
    // 由原始的爻信息推算出爻
    var yaoInt=0;
    for( var yr in yaoRaw) {
        if(yaoRaw[yr] === 1) {
            yaoInt += 3;
        } else {
            yaoInt += 2;
        }
    }
    var yao=0;
    if ( yaoInt === 6 || yaoInt === 8 ) {
        yao=0
    } else if ( yaoInt === 7 || yaoInt === 9 ) {
        yao=1
    } else {
        alert("ERROR yao int: "+yaoInt+yaoRaw);
    }
    // console.log("yaoInt: "+yaoInt)
    return yao
}


function getYao() {
    var yaoRaw = [];
    var yao = 0;   
    yaoRaw = getYaoRaw();
    yao = _getYao(yaoRaw);
    return yao
}

function getGua() {
    // 卦 6爻
    var gua=[]
    for (var i=0;i<6;i++) {
        gua.push(getYao())
        //console.log(gua)
    }
    return gua
}

function saveYao(yao){
    var yao_list = sessionStorage.getItem("yao_list")
    if (yao_list === null) {
        yao_list=[]
    } else {
        yao_list=JSON.parse(yao_list)
    }
    yao_list.push(yao)
    sessionStorage.setItem("yao_list",JSON.stringify(yao_list))
    
}

//JSON.parse(JSON.stringify([1,0,1,0]))
function drawYao(yaoRaw) {
    var yao = _getYao(yaoRaw);
    saveYao(yao);
    var yaoStr= yaoRaw + " ------------ "+yao
    var node=document.createElement("LI");
    var textnode=document.createTextNode(yaoStr);
    node.appendChild(textnode);
    document.getElementById("gua").appendChild(node);
}

function operation() {
    var num = sessionStorage.getItem("num")
    if (num === null ){
        num=0;
    } else {
        num=parseInt(num)
    }
    num += 1;
    sessionStorage.setItem("num",num);
    // console.log(num)
    if (num>7) {
        num=0;
        sessionStorage.setItem("num",num);
        document.getElementById("gua").innerHTML=""
        alert("clear");
        sessionStorage.removeItem("yao_list")
    } else if (num === 7) {
        showGua();
    } else {
        drawYao(getYaoRaw());
    } 
}

function showGua(){
    // console.log("xxxx")
    var gua=JSON.parse(sessionStorage.getItem("yao_list"))
    console.log(gua)
    alert(gua)
    // alert("")
}

</script>

</body>
</html>